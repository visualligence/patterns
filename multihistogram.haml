- sy = 0
- style_text = "font-size:1px;font-family:Trebuchet MS;fill:#888;text-anchor:initial;text-align:left;writing-mode:lr;alignment-baseline:central"
%g{ :transform => "scale(10)" }
	- data[0].keys.each_with_index do |k,ki|
		- max_value = data.max_by{|a| a[k]}[k] rescue nil
		- min_value = data.max_by{|a| a[k]}[k] rescue nil
		- legend = {}
		- data.each_with_index do |d,i|
			-v = d[ k ].to_s
			-begin
				-legend[ v ] ||= "hsl(#{ k.hash.to_f % 360.0 }, 100%, #{10.0 + d[k].to_f * 35.0 / max_value }%)"
			-rescue TypeError
				-legend[ v ] ||= "hsl(#{( k.hash.to_f + d[k].hash.to_f ) % 360.0}, 45%, 25%)"
			-rescue
				-legend[ v ] ||= "#aaaa00"
		%text{ :x => 0 ,:y => sy, :style => style_text }= k.to_s
		- sy = sy + 1
		- if( max_value && min_value )
			%text{ :x => 1, :y => sy,                            :style => "#{style_text};fill:#{legend[min_value]}" }= min_value
			%rect{ :x => 0, :y => sy, :height => 1, :width => 1, :style => "fill:#{legend[min_value]}" }
			- sy = sy + 1
			%text{ :x => 1, :y => sy,                            :style => "#{style_text};fill:#{legend[max_value]}" }= max_value
			%rect{ :x => 0, :y => sy, :height => 1, :width => 1, :style => "fill:#{legend[max_value]}" }
		-else
			-legend.each do |v_color,i|
				- v,color = v_color
				%text{ :x => 1, :y => sy,                            :style => "#{style_text};fill:#{color}" }= v.to_s
				%rect{ :x => 0, :y => sy, :height => 1, :width => 1, :style => "fill:#{color}" }
		- sy = sy + 1
